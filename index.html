<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Media API</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 30px;
            background: #fafafa;
            color: #222;
        }
        h1, h2 {
            color: #005c99;
        }
        code {
            background: #eee;
            padding: 2px 4px;
        }
        pre {
            background: #f0f0f0;
            padding: 10px;
            overflow-x: auto;
        }
        button {
            background: #007acc;
            color: #fff;
            border: none;
            padding: 8px 16px;
            cursor: pointer;
        }
        button:hover {
            background: #005f9e;
        }
        .section {
            margin-bottom: 25px;
            padding: 15px;
            background: #fff;
            border: 1px solid #ddd;
        }
        .key-box {
            margin-top: 10px;
            font-family: monospace;
            background: #efefef;
            padding: 8px;
            border: 1px solid #ccc;
            word-break: break-all;
        }
    </style>
</head>
<body>

<h1>Media REST API</h1>

<div class="section">
    <h2>Описание</h2>
    <p>API предоставляет CRUD‑операции для сущности <b>Медиафайлы</b>.</p>
    <ul>
        <li><code>GET /api/media</code> — получить все записи</li>
        <li><code>GET /api/media/{id}</code> — получить запись по ID</li>
        <li><code>POST /api/media</code> — создать запись</li>
        <li><code>PUT /api/media/{id}</code> — обновить запись</li>
        <li><code>DELETE /api/media/{id}</code> — удалить запись</li>
    </ul>
    <p>Требуется заголовок:</p>
    <pre><code>X-API-Key: &lt;your_api_key&gt;</code></pre>
    <p>Запросы и ответы возвращаются в формате JSON.</p>
</div>

<div class="section">
    <h2>Генерация API‑ключа</h2>
    <p>Нажмите кнопку, чтобы создать новый ключ.  
       Хеш сохранится в базе, а сам ключ отобразится ниже <i>только один раз</i>.</p>
    <button id="generate">Сгенерировать ключ</button>
    <div id="result" class="key-box" style="display:none"></div>
</div>

<div class="section">
    <h2>Примеры запросов</h2>
    <pre>GET  /api/media
Header: X-API-Key: your_key_here

POST /api/media
Body (JSON):
{
  "filename": "newfile.png",
  "original_name": "holiday.png",
  "mime_type": "image/png",
  "size": 12345
}</pre>
</div>

<script>
document.getElementById('generate').addEventListener('click', async () => {
    const box = document.getElementById('result');
    box.style.display = "block";
    box.textContent = "Генерация...";
    try {
        const res = await fetch('generate_key.php');
        const data = await res.json();
        if (data.api_key) {
            box.textContent = data.api_key;
            box.style.background = "#e6ffe6";
        } else {
            box.textContent = "Ошибка: " + (data.error || "не удалось получить ключ");
            box.style.background = "#ffe6e6";
        }
    } catch (e) {
        box.textContent = "Ошибка соединения";
        box.style.background = "#ffe6e6";
    }
});
</script>

</body>
</html>